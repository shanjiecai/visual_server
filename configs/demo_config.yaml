# è§†é¢‘æµå¤„ç†æœåŠ¡é…ç½®æ–‡ä»¶

# æœåŠ¡é…ç½®
service:
  name: "video_stream_service"
  version: "1.0.0"
  host: "localhost"
  port: 8080
  worker_count: 4
  max_queue_size: 100
  health_check_interval: 30.0
  metrics_collection_interval: 60.0


# ç›¸ä¼¼å¸§è¿‡æ»¤å™¨é…ç½®
similar_frame_filter:
  similarity_threshold: 0.8
  comparison_method: "clip"
  clip_model_path: "models/clip-vit-base-patch32"
  history_size: 5
  min_time_interval: 0.5

# è§†é¢‘æºé…ç½®
video_source:
  source_type: "camera"  # mock, file, camera, rtmp, webrtc
  source_path: null    # è§†é¢‘æ–‡ä»¶è·¯å¾„æˆ–æ‘„åƒå¤´è®¾å¤‡ID
  fps: 1.0
  max_frames: null     # nullè¡¨ç¤ºæ— é™åˆ¶
  loop: false          # æ˜¯å¦å¾ªç¯æ’­æ”¾ï¼ˆä»…å¯¹æ–‡ä»¶æœ‰æ•ˆï¼‰
  config:
    # WebRTCé…ç½®
    url: "http://112.13.96.171:1081/api/call/whep/get?src=1830004229212345670000034"
    max_frames_buffer: 1
    connection_timeout: 10
    # è§†é¢‘æºç‰¹å®šé…ç½®
    quality: "high"
    buffer_size: 10

# é¢„å¤„ç†å™¨é…ç½®
preprocessors:
  memory_extractor:
    enabled: true
    processor_type: "memory_extractor"
    batch_size: 1
    max_concurrent: 2
    timeout: 30.0
    config:
      extraction_method: "feature_based"
      memory_threshold: 0.7
  
  yolo_detector:
    enabled: true
    processor_type: "yolo_detector"
    batch_size: 4
    max_concurrent: 2
    timeout: 15.0
    model_path: "models/yoloe-v8l-seg.pt"
    device: "cpu"
    confidence_threshold: 0.5
    nms_threshold: 0.4
    target_classes: ["person"]  # ä¸“æ³¨äºäººå‘˜æ£€æµ‹
    enable_downstream: true  # å¯ç”¨ä¸‹æ¸¸å¤„ç†
  
  similar_frame_filter:
    enabled: true
    processor_type: "similar_frame_filter"
    batch_size: 1
    max_concurrent: 4
    timeout: 10.0
    similarity_threshold: 0.8
    comparison_method: "clip"
    clip_model_path: "models/clip-vit-base-patch32"
    history_size: 5
    min_time_interval: 0.5

# é˜Ÿåˆ—é…ç½®
queue:
  type: "kafka"  # ä½¿ç”¨Kafkaé˜Ÿåˆ—
  config:
    # bootstrap_servers: ["localhost:9092"]
    bootstrap_servers: ["36.137.208.165:5092"]  # æµ‹è¯•ç¯å¢ƒåœ°å€
    topic_name: "demo"
    consumer_group: "vlm_workers"
    use_kafka: true
    max_request_size: 10485760
    timeout_default: 30.0
    serialize_messages: true

# VLMä»»åŠ¡é…ç½® - ç‹¬ç«‹äºé¢„å¤„ç†å™¨
vlm_task_config:
  person_detection:
    task_type: "person_detection"
    system_prompt: |
      ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå½“æ£€æµ‹åˆ°æœ‰äººå‡ºç°æ—¶ï¼Œéœ€è¦ç”¨æ¸©æš–å‹å¥½çš„è¯­æ°”å‘ä»–ä»¬æ‰“æ‹›å‘¼ã€‚
      
      è¯·æ ¹æ®å›¾åƒä¸­äººå‘˜çš„æƒ…å†µï¼ˆäººæ•°ã€ä½ç½®ç­‰ï¼‰ï¼Œç”Ÿæˆåˆé€‚çš„é—®å€™è¯­ã€‚
      ä¿æŒè¯­æ°”è‡ªç„¶ã€å‹å¥½ã€çƒ­æƒ…ã€‚
    user_prompt: "ä½ å¥½ï¼æˆ‘çœ‹åˆ°æœ‰äººå‡ºç°åœ¨ç”»é¢ä¸­ï¼Œè¯·å‘ä»–ä»¬æ‰“ä¸ªæ‹›å‘¼å§ã€‚"
    # vlm_config:
    #   model: "Qwen2.5-VL-72B-Instruct-AWQ"
    #   max_tokens: 128
    #   temperature: 0.8
    #   base_url: "http://cc.komect.com/llm/vlgroup/"
    #   api_key: "EMPTY"
  
  object_detection:
    task_type: "object_detection"
    system_prompt: |
      ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç‰©ä½“æ£€æµ‹å’Œåœºæ™¯åˆ†æä¸“å®¶ã€‚è¯·åˆ†æå›¾åƒä¸­çš„ç‰©ä½“å’Œåœºæ™¯ä¿¡æ¯ã€‚
      
      è¯·é‡ç‚¹å…³æ³¨ï¼š
      1. ç‰©ä½“çš„ç±»å‹å’Œä½ç½®
      2. ç‰©ä½“çš„çŠ¶æ€å’Œæ¡ä»¶
      3. åœºæ™¯çš„æ•´ä½“å¸ƒå±€
      4. ç‰©ä½“ä¹‹é—´çš„å…³ç³»
    user_prompt: "è¯·åˆ†æå›¾åƒä¸­çš„ç‰©ä½“å’Œåœºæ™¯ï¼Œæè¿°ç‰©ä½“çš„ç±»å‹ã€ä½ç½®å’Œç›¸äº’å…³ç³»ã€‚"
    # vlm_config:
    #   model: "Qwen2.5-VL-72B-Instruct-AWQ"
    #   max_tokens: 256
    #   temperature: 0.3
    #   base_url: "http://cc.komect.com/llm/vlgroup/"
    #   api_key: "EMPTY"
  
  general_analysis:
    task_type: "general_analysis"
    system_prompt: |
      ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†è§‰åˆ†æä¸“å®¶ã€‚è¯·å¯¹å›¾åƒè¿›è¡Œå…¨é¢çš„åˆ†æå’Œæè¿°ã€‚
      
      è¯·é‡ç‚¹å…³æ³¨ï¼š
      1. åœºæ™¯çš„æ•´ä½“æè¿°
      2. é‡è¦ç‰©ä½“å’Œäººå‘˜
      3. ç¯å¢ƒå’Œæ°›å›´
      4. å€¼å¾—æ³¨æ„çš„ç»†èŠ‚
    user_prompt: "è¯·å¯¹è¿™å¼ å›¾åƒè¿›è¡Œå…¨é¢åˆ†æï¼Œæè¿°ä½ è§‚å¯Ÿåˆ°çš„å†…å®¹ã€‚"
    # vlm_config:
    #   model: "Qwen2.5-VL-72B-Instruct-AWQ"
    #   max_tokens: 512
    #   temperature: 0.5
    #   base_url: "http://cc.komect.com/llm/vlgroup/"
    #   api_key: "EMPTY"

# ç¼“å­˜é…ç½®
cache:
  cache_type: "frame"  # memory, lru, frame
  max_size: 1000
  default_ttl: 3600  # 1å°æ—¶
  serialize_values: true
  config:
    frame_ttl: 1800     # è§†é¢‘å¸§ç¼“å­˜30åˆ†é’Ÿ
    result_ttl: 3600    # å¤„ç†ç»“æœç¼“å­˜1å°æ—¶
    max_frame_size: 500
    max_result_size: 1000
    cleanup_interval: 300

# åå¤„ç†å™¨é…ç½®
postprocessors:
  greeting_printer:
    enabled: true
    processor_type: "greeting_printer"
    timeout: 5.0
    max_retries: 1
    trigger_conditions:
      - type: "detection_threshold"
        threshold: 1
      - type: "task_type"
        task_types: ["person_detection"]
    greeting_config:
      print_format: "ğŸ¤– AIæ‰“æ‹›å‘¼: {content}"
      include_metadata: true
      show_person_count: true
