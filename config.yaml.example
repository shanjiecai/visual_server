# è§†é¢‘æµå¤„ç†æœåŠ¡é…ç½®æ–‡ä»¶ç¤ºä¾‹
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º config.yaml å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®

# æœåŠ¡é…ç½®
service:
  name: "video_stream_service"
  version: "1.0.0"
  host: "localhost"
  port: 8080
  worker_count: 4
  max_queue_size: 100
  health_check_interval: 30.0
  metrics_collection_interval: 60.0

# æ‘„åƒå¤´é…ç½®ï¼ˆç”¨äºdemo.pyï¼‰
camera:
  camera_index: 0        # æ‘„åƒå¤´ç´¢å¼•ï¼Œ0ä¸ºé»˜è®¤æ‘„åƒå¤´
  fps: 1.0              # æ¯ç§’æ•è·å¸§æ•°ï¼Œå»ºè®®1-2å¸§é¿å…è¿‡äºé¢‘ç¹
  resolution: [640, 480] # åˆ†è¾¨ç‡ [å®½åº¦, é«˜åº¦]

# è§†é¢‘æºé…ç½®ï¼ˆæ‰©å±•é…ç½®ï¼Œæš‚æœªä½¿ç”¨ï¼‰
video_source:
  source_type: "camera"  # æ”¯æŒ: mock, file, camera, rtmp, webrtc
  source_path: null      # è§†é¢‘æ–‡ä»¶è·¯å¾„æˆ–æ‘„åƒå¤´è®¾å¤‡ID
  fps: 30.0
  max_frames: null       # nullè¡¨ç¤ºæ— é™åˆ¶
  loop: false            # æ˜¯å¦å¾ªç¯æ’­æ”¾ï¼ˆä»…å¯¹æ–‡ä»¶æœ‰æ•ˆï¼‰
  config:
    # WebRTCé…ç½®ç¤ºä¾‹
    url: "http://example.com/webrtc/stream"
    max_frames_buffer: 1
    connection_timeout: 10
    # è§†é¢‘æºç‰¹å®šé…ç½®
    quality: "high"
    buffer_size: 10

# é¢„å¤„ç†å™¨é…ç½®
preprocessors:
  # å†…å­˜æå–å™¨ï¼ˆæš‚æœªå¯ç”¨ï¼‰
  memory_extractor:
    enabled: false
    processor_type: "memory_extractor"
    batch_size: 1
    max_concurrent: 2
    timeout: 30.0
    config:
      extraction_method: "feature_based"
      memory_threshold: 0.7
  
  # YOLOç›®æ ‡æ£€æµ‹å™¨
  yolo_detector:
    enabled: true
    processor_type: "yolo_detector"
    batch_size: 4
    max_concurrent: 2
    timeout: 15.0
    model_path: "models/yolo-v8l-seg.pt"  # YOLOæ¨¡å‹è·¯å¾„ï¼Œè¯·ç¡®ä¿æ–‡ä»¶å­˜åœ¨
    device: "cpu"                         # ä½¿ç”¨è®¾å¤‡: cpu æˆ– cuda
    confidence_threshold: 0.5             # ç½®ä¿¡åº¦é˜ˆå€¼
    nms_threshold: 0.4                    # éæå¤§å€¼æŠ‘åˆ¶é˜ˆå€¼
    target_classes: ["person"]           # ç›®æ ‡æ£€æµ‹ç±»åˆ«ï¼Œä¸“æ³¨äºäººå‘˜æ£€æµ‹
    enable_downstream: true               # å¯ç”¨ä¸‹æ¸¸å¤„ç†ï¼ˆå‘é€åˆ°VLMï¼‰
    
    # ä»»åŠ¡é…ç½® - å®šä¹‰ä¸åŒæ£€æµ‹åœºæ™¯çš„æç¤ºè¯
    task_configs:
      person_detection:
        system_prompt: |
          ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå½“æ£€æµ‹åˆ°æœ‰äººå‡ºç°æ—¶ï¼Œéœ€è¦ç”¨æ¸©æš–å‹å¥½çš„è¯­æ°”å‘ä»–ä»¬æ‰“æ‹›å‘¼ã€‚
          
          è¯·æ ¹æ®å›¾åƒä¸­äººå‘˜çš„æƒ…å†µï¼ˆäººæ•°ã€ä½ç½®ç­‰ï¼‰ï¼Œç”Ÿæˆåˆé€‚çš„é—®å€™è¯­ã€‚
          ä¿æŒè¯­æ°”è‡ªç„¶ã€å‹å¥½ã€çƒ­æƒ…ã€‚
        user_prompt: "ä½ å¥½ï¼æˆ‘çœ‹åˆ°æœ‰äººå‡ºç°åœ¨ç”»é¢ä¸­ï¼Œè¯·å‘ä»–ä»¬æ‰“ä¸ªæ‹›å‘¼å§ã€‚"
        task_type: "person_detection"
      
      object_detection:
        system_prompt: |
          ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç‰©ä½“æ£€æµ‹å’Œåœºæ™¯åˆ†æä¸“å®¶ã€‚è¯·åˆ†æå›¾åƒä¸­çš„ç‰©ä½“å’Œåœºæ™¯ä¿¡æ¯ã€‚
          
          è¯·é‡ç‚¹å…³æ³¨ï¼š
          1. ç‰©ä½“çš„ç±»å‹å’Œä½ç½®
          2. ç‰©ä½“çš„çŠ¶æ€å’Œæ¡ä»¶
          3. åœºæ™¯çš„æ•´ä½“å¸ƒå±€
          4. ç‰©ä½“ä¹‹é—´çš„å…³ç³»
        user_prompt: "è¯·åˆ†æå›¾åƒä¸­çš„ç‰©ä½“å’Œåœºæ™¯ï¼Œæè¿°ç‰©ä½“çš„ç±»å‹ã€ä½ç½®å’Œç›¸äº’å…³ç³»ã€‚"
        task_type: "object_detection"
      
      general_analysis:
        system_prompt: |
          ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†è§‰åˆ†æä¸“å®¶ã€‚è¯·å¯¹å›¾åƒè¿›è¡Œå…¨é¢çš„åˆ†æå’Œæè¿°ã€‚
          
          è¯·é‡ç‚¹å…³æ³¨ï¼š
          1. åœºæ™¯çš„æ•´ä½“æè¿°
          2. é‡è¦ç‰©ä½“å’Œäººå‘˜
          3. ç¯å¢ƒå’Œæ°›å›´
          4. å€¼å¾—æ³¨æ„çš„ç»†èŠ‚
        user_prompt: "è¯·å¯¹è¿™å¼ å›¾åƒè¿›è¡Œå…¨é¢åˆ†æï¼Œæè¿°ä½ è§‚å¯Ÿåˆ°çš„å†…å®¹ã€‚"
        task_type: "general_analysis"
  
  # Mask2Formeråˆ†å‰²å™¨ï¼ˆå¯é€‰ï¼‰
  mask2former:
    enabled: false  # æš‚æ—¶å…³é—­ï¼Œç®€åŒ–æµç¨‹
    processor_type: "mask2former"
    batch_size: 2
    max_concurrent: 1
    timeout: 45.0
    config:
      model_path: "models/mask2former.pt"
      classes: ["person", "vehicle", "background"]
  
  # ç›¸ä¼¼å¸§è¿‡æ»¤å™¨
  similar_frame_filter:
    enabled: true
    processor_type: "similar_frame_filter"
    batch_size: 1
    max_concurrent: 4
    timeout: 10.0
    similarity_threshold: 0.8              # ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œè¶Šé«˜è¶Šä¸¥æ ¼
    comparison_method: "clip"              # æ¯”è¾ƒæ–¹æ³•: clip, histogram, ssim
    clip_model_path: "models/clip-vit-base-patch32"  # CLIPæ¨¡å‹è·¯å¾„
    history_size: 5                        # å†å²å¸§ç¼“å­˜å¤§å°
    min_time_interval: 0.5                 # æœ€å°æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰

# é˜Ÿåˆ—é…ç½®ï¼ˆæ‰©å±•é…ç½®ï¼‰
queue:
  queue_type: "kafka"  # æ”¯æŒ: memory, rabbitmq, kafka
  max_size: 1000
  timeout_default: 30.0
  serialize_messages: true
  use_priority: true
  cleanup_interval: 300

# æ¶ˆæ¯é˜Ÿåˆ—é…ç½®ï¼ˆå®é™…ä½¿ç”¨ï¼‰
message_queue:
  type: "kafka"  # ä½¿ç”¨Kafkaé˜Ÿåˆ—
  config:
    bootstrap_servers: ["localhost:9092"]  # KafkaæœåŠ¡å™¨åœ°å€
    topic_name: "demo"                     # ä¸»é¢˜åç§°ï¼Œéœ€ä¸workeré…ç½®ä¸€è‡´
    consumer_group: "demo"                 # æ¶ˆè´¹è€…ç»„
    use_kafka: true                        # è®¾ä¸ºfalseåˆ™ä½¿ç”¨å†…å­˜é˜Ÿåˆ—
    max_request_size: 10485760             # 10MBï¼Œæœ€å¤§æ¶ˆæ¯å¤§å°

# ç¼“å­˜é…ç½®
cache:
  cache_type: "frame"  # æ”¯æŒ: memory, lru, frame
  max_size: 1000
  default_ttl: 3600    # 1å°æ—¶ï¼Œé»˜è®¤ç”Ÿå­˜æ—¶é—´
  serialize_values: true
  config:
    frame_ttl: 1800      # è§†é¢‘å¸§ç¼“å­˜30åˆ†é’Ÿ
    result_ttl: 3600     # å¤„ç†ç»“æœç¼“å­˜1å°æ—¶
    max_frame_size: 500
    max_result_size: 1000
    cleanup_interval: 300

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"  # æ—¥å¿—çº§åˆ«: DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_path: "logs/video_stream.log"  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  max_file_size: 10485760             # 10MBï¼Œæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°
  backup_count: 5                     # ä¿ç•™çš„å¤‡ä»½æ—¥å¿—æ–‡ä»¶æ•°é‡
  console_output: true                # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°

# åå¤„ç†å™¨é…ç½®
postprocessors:
  # æ‰“æ‹›å‘¼æ‰“å°å™¨
  greeting_printer:
    enabled: true
    processor_type: "greeting_printer"
    timeout: 5.0
    max_retries: 1
    trigger_conditions:
      - type: "detection_threshold"
        threshold: 1                    # æ£€æµ‹åˆ°è‡³å°‘1ä¸ªäººæ—¶è§¦å‘
      - type: "task_type"
        task_types: ["person_detection"] # ä»…å¯¹äººå‘˜æ£€æµ‹ä»»åŠ¡è§¦å‘
    greeting_config:
      print_format: "ğŸ¤– AIæ‰“æ‹›å‘¼: {content}"
      include_metadata: true
      show_person_count: true

# æ’ä»¶é…ç½®ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
plugins: {}

# ä½¿ç”¨è¯´æ˜ï¼š
# 
# 1. å¿«é€Ÿå¼€å§‹ï¼ˆå‰å°è¿è¡Œï¼Œå¼€å‘è°ƒè¯•ï¼‰ï¼š
#    python main.py run demo                    # è¿è¡Œæ¼”ç¤ºç¨‹åº
#    python main.py run worker                  # è¿è¡ŒVLMå·¥ä½œè¿›ç¨‹
#    python main.py run both                    # åŒæ—¶è¿è¡Œä¸¤è€…
#
# 2. ç”Ÿäº§ç¯å¢ƒï¼ˆåå°è¿è¡Œï¼‰ï¼š
#    python main.py start demo                  # åå°å¯åŠ¨æ¼”ç¤ºç¨‹åº
#    python main.py start worker               # åå°å¯åŠ¨VLMå·¥ä½œè¿›ç¨‹
#    python main.py stop                       # åœæ­¢æ‰€æœ‰ç»„ä»¶
#    python main.py status                     # æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
#
# 3. é…ç½®è¦æ±‚ï¼š
#    - ç¡®ä¿ models/ ç›®å½•ä¸‹æœ‰ç›¸åº”çš„æ¨¡å‹æ–‡ä»¶
#    - å¦‚æœä½¿ç”¨Kafkaï¼Œç¡®ä¿KafkaæœåŠ¡æ­£åœ¨è¿è¡Œ
#    - æ—¥å¿—æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºåœ¨ logs/ ç›®å½•ä¸‹
#    - æ‘„åƒå¤´ç´¢å¼•æ ¹æ®ç³»ç»Ÿå®é™…æƒ…å†µè°ƒæ•´
#    - å¯ä»¥é€šè¿‡ä¿®æ”¹ fps æ¥æ§åˆ¶å¤„ç†é¢‘ç‡ 